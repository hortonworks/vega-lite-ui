!function(){"use strict";angular.module("vlui",["ui.select"]).constant("_",window._).constant("dl",window.dl).constant("vl",window.vl).constant("vg",window.vg).constant("jQuery",window.$).constant("Blob",window.Blob).constant("URL",window.URL).constant("Drop",window.Drop).constant("Heap",window.Heap).constant("consts",{addCount:!0,debug:!1,useUrl:!0,logging:!1,defaultConfigSet:"large",appId:"vlui",priority:{bookmark:0,popup:0,vislist:1e3},myriaRest:""})}(),function(){angular.module("vlui").run(["$templateCache",function(e){e.put("fieldinfo/fieldinfo.html",'<span class="field-info"><span class="hflex full-width" ng-click="clicked($event)"><span class="type-caret" ng-class="{active: !disableCountCaret || field.aggregate!==\'count\'}"><i class="fa fa-caret-down" ng-show="showCaret"></i> <span class="type icon-small icon-type-{{typeNames[field.type]}}" ng-show="showType" title="{{typeNames[field.type]}}">{{field.type}}</span></span> <span ng-if="field.aggregate!==\'count\'" class="field-info-text"><span ng-if="func(field)" class="field-func" ng-class="{any: field._any}">{{ func(field) }}</span> <span class="field-func">{{ field._aggregate || (field._raw ? \'raw\' : \'\' )}}</span><span class="field-name" ng-class="{hasfunc: func(field), any: field._any}">{{ field.name | underscore2space }}</span></span> <span ng-if="field.aggregate===\'count\'" class="field-count field-info-text"><span class="field-name">COUNT</span></span> <span class="no-shrink remove" ng-show="showRemove"><a class="remove-field" ng-click="removeAction()"><i class="fa fa-times"></i></a></span> <span class="no-shrink info" ng-show="showInfo"><i ng-if="field.aggregate !== \'count\' && isTypes(field, [\'N\', \'O\'])" class="fa fa-info-circle" tooltips="" tooltip-size="small" tooltip-html="<div class=\'tooltip-content\'> <strong>Name:</strong> {{field.name}}<br> <strong>Cardinality:</strong> {{stats.distinct | number}}<br> <strong>Min:</strong> {{stats.min}}<br> <strong>Max:</strong> {{stats.max}}<br> <strong>Max length:</strong> {{stats.maxlength | number}}<br> <strong>Sample:</strong> <span class=\'sample\'>{{stats.sample.join(\', \')}}</span> </div>" tooltip-side="right"></i> <i ng-if="field.aggregate !== \'count\' && field.type === \'T\'" class="fa fa-info-circle" tooltips="" tooltip-size="small" tooltip-html="<div class=\'tooltip-content\'> <strong>Name:</strong> {{field.name}}<br> <strong>Cardinality:</strong> {{stats.distinct | number}}<br> <strong>Min:</strong> {{stats.min | date: short}}<br> <strong>Max:</strong> {{stats.max | date: short}}<br> <strong>Sample:</strong> <span class=\'sample\'>{{stats.sample.join(\', \')}}</span> </div>" tooltip-side="right"></i> <i ng-if="field.aggregate !== \'count\' && field.type === \'Q\'" class="fa fa-info-circle" tooltips="" tooltip-size="small" tooltip-html="<div class=\'tooltip-content\'> <strong>Name:</strong> {{field.name}}<br> <strong>Cardinality:</strong> {{stats.distinct | number}}<br> <strong>Min:</strong> {{stats.min | number}}<br> <strong>Max:</strong> {{stats.max | number}}<br> <strong>Stdev:</strong> {{stats.stdev | number:2}}<br> <strong>Mean:</strong> {{stats.mean | number:2}}<br> <strong>Median:</strong> {{stats.median | number}}<br> <strong>Sample:</strong> <span class=\'sample\'>{{stats.sample.join(\', \')}}</span> </div>" tooltip-side="right"></i><i ng-if="field.aggregate === \'count\'" class="fa fa-info-circle" tooltips="" tooltip-size="small" tooltip-html="<div class=\'tooltip-content\'> <strong>Count:</strong> {{stats.max}} </div>" tooltip-side="right"></i></span></span></span>'),e.put("vlplotgroup/vlplotgroup.html",'<div class="vl-plot-group card vflex"><div ng-show="showExpand || fieldSet || showBookmark || showToggle" class="vl-plot-group-header full-width no-shrink"><div class="field-set-info"><field-info ng-repeat="field in fieldSet" ng-if="fieldSet" field="field" show-type="true" ng-class="{ selected: alwaysSelected || (isSelected && isSelected(field.name)), unselected: isSelected && !isSelected(field.name), highlighted: (highlighted||{})[field.name] }" ng-mouseover="(highlighted||{})[field.name] = true" ng-mouseout="(highlighted||{})[field.name] = false"></field-info></div><div class="toolbox"><div class="drop-container"><div class="popup-menu popup-command no-shrink dev-tool"><div class="command debug"><span class="debug">Vls</span> <a class="debug" ui-zeroclip="" zeroclip-copied="shCopied=\'(Coplied)\'" zeroclip-model="chart.shorthand">Copy</a> / <a class="debug" ng-click="logCode(\'VL shorthand\', chart.shorthand); shCopied=\'(Logged)\';">Log</a> <span>{{shCopied}}</span></div><div class="command debug"><span class="debug">Vl</span> <a class="debug" ui-zeroclip="" zeroclip-copied="vlCopied=\'(Coplied)\'" zeroclip-model="chart.cleanSpec | compactJSON">Copy</a> / <a class="debug" ng-click="logCode(\'Vega-lite\', chart.cleanSpec); vlCopied=\'(Logged)\';">Log</a> <span>{{vlCopied}}</span></div><div class="command debug"><span class="debug">Vg</span> <a class="debug" ui-zeroclip="" zeroclip-copied="vgCopied=\'(Coplied)\'" zeroclip-model="chart.vgSpec | compactJSON">Copy</a> / <a class="debug" ng-click="logCode(\'Vega\', chart.vgSpec); vgCopied=\'(Logged)\';">Log</a> <span>{{vgCopied}}</span></div><a class="command debug" ng-href="{{ {type:\'vl\', encoding: chart.cleanSpec} | reportUrl }}" target="_blank">Report Bad Render</a> <a ng-click="showFeature=!showFeature" class="command debug">{{chart.score}}</a><div ng-repeat="f in chart.scoreFeatures track by f.reason">[{{f.score}}] {{f.reason}}</div></div></div><a ng-if="showMarkType" ng-class="{command: true, active: chartType===\'point\'}" title="Point" ng-click="chartChange(\'point\')"><i class="fa fa-circle-o"></i></a> <a ng-if="showMarkType" ng-class="{command: true, active: chartType===\'bar\'}" title="Bar" ng-click="chartChange(\'bar\')"><i class="fa fa-bar-chart"></i></a> <a ng-if="showMarkType" ng-class="{command: true, active: chartType===\'area\'}" title="Area" ng-click="chartChange(\'area\')"><i class="fa fa-area-chart"></i></a> <a ng-if="showMarkType" ng-class="{command: true, active: chartType===\'line\'}" title="Line" ng-click="chartChange(\'line\')"><i class="fa fa-line-chart"></i></a> <a ng-if="showMarkType" ng-class="{command: true, active: chartType===\'tick\'}" title="Tick" ng-click="chartChange(\'tick\')"><i class="fa fa-dot-circle-o"></i></a> <a ng-if="showMarkType" ng-class="{command: true, active: chartType===\'text\'}" title="Text" ng-click="chartChange(\'text\')"><i class="fa fa-font"></i></a> <a ng-if="showLog && chart.vlSpec && log.support(chart.vlSpec, \'x\')" class="command" ng-click="log.toggle(chart.vlSpec, \'x\')" ng-class="{active: log.active(chart.vlSpec, \'x\')}"><i class="fa fa-long-arrow-right"></i> <small>LOG X</small></a> <a ng-if="showLog && chart.vlSpec && log.support(chart.vlSpec, \'y\')" class="command" ng-click="log.toggle(chart.vlSpec, \'y\')" ng-class="{active: log.active(chart.vlSpec, \'y\')}"><i class="fa fa-long-arrow-up"></i> <small>LOG Y</small></a> <a ng-show="showSort && chart.vlSpec && toggleSort.support(chart.vlSpec, Dataset.stats)" class="command" ng-click="toggleSort(chart.vlSpec)"><i class="fa sort" ng-class="toggleSortClass(chart.vlSpec)"></i> <small ng-if="showLabel">Sort</small></a> <a ng-if="showFilterNull && chart.vlSpec && toggleFilterNull.support(chart.vlSpec, Dataset.stats)" class="command" ng-click="toggleFilterNull(chart.vlSpec)" ng-class="{active: chart.vlSpec && chart.vlSpec.cfg.filterNull.O}"><i class="fa fa-filter"></i> <small ng-if="showLabel">Filter</small> <small>NULL</small></a> <a ng-if="showTranspose" class="command" ng-click="transpose()"><i class="fa fa-refresh transpose"></i> <small ng-if="showLabel">Transpose</small></a> <a ng-click="toggleFullscreen()" class="command"><i class="fa fa-expand"></i></a></div></div><div class="vl-plot-wrapper full-width vis-{{fieldSet.key}} flex-grow-1"><vl-plot chart="chart" disabled="disabled" is-in-list="isInList" always-scrollable="alwaysScrollable" config-set="{{configSet||\'small\'}}" max-height="maxHeight" max-width="maxWidth" overflow="overflow" priority="priority" rescale="rescale" thumbnail="thumbnail" tooltip="tooltip" rendering="rendering"></vl-plot></div></div>'),e.put("vlplot/vlplot.html",'<div class="vis" id="vis-{{visId}}" ng-class="{ fit: !alwaysScrollable && !overflow && (maxHeight && (!height || height <= maxHeight)) && (maxWidth && (!width || width <= maxWidth)), overflow: alwaysScrollable || overflow || (maxHeight && height && height > maxHeight) || (maxWidth && width && width > maxWidth), scroll: alwaysScrollable || unlocked || hoverFocus }" ng-mousedown="unlocked=!thumbnail" ng-mouseup="unlocked=false" ng-mouseover="mouseover()" ng-mouseout="mouseout()"><div class="vis-tooltip" ng-show="tooltipActive"><table><tr ng-repeat="p in data"><td class="key">{{p[0]}}</td><td class="value"><b ng-if="p.isNumber">{{p[1]| number: 2}}</b> <b ng-if="!p.isNumber">{{p[1]}}</b></td></tr></table></div></div>')}])}(),function(){"use strict";angular.module("vlui").service("Alerts",function(e,t){var n={};return n.alerts=[],n.add=function(a,o){var r={msg:a};n.alerts.push(r),o&&e(function(){var e=t.findIndex(n.alerts,r);n.closeAlert(e)},o)},n.closeAlert=function(e){n.alerts.splice(e,1)},n})}(),function(){"use strict";angular.module("vlui").factory("Config",function(e,t){var n={};return n.schema=e.schema.schema.properties.config,n.dataschema=e.schema.schema.properties.data,n.data=e.schema.util.instantiate(n.dataschema),n.config=e.schema.util.instantiate(n.schema),n.getConfig=function(){return t.cloneDeep(n.config)},n.getData=function(){return t.cloneDeep(n.data)},n.large=function(){return{singleWidth:400,singleHeight:400,largeBandMaxCardinality:20}},n.small=function(){return{}},n.updateDataset=function(e,t){e.values?(n.data.values=e.values,delete n.data.url,n.data.formatType=void 0):(n.data.url=e.url,delete n.data.values,n.data.formatType=t)},n})}(),function(){"use strict";angular.module("vlui").directive("fieldInfo",function(e,t,n){return{templateUrl:"fieldinfo/fieldinfo.html",restrict:"E",replace:!0,scope:{field:"=",showType:"=",showInfo:"=",showCaret:"=",popupContent:"=",showRemove:"=",removeAction:"&",action:"&",disableCountCaret:"="},link:function(a,o){var r;a.typeNames=e.typeNames,a.stats=e.stats[a.field.name],a.isTypes=n.field.isTypes,a.clicked=function(e){a.action&&e.target!==o.find(".fa-caret-down")[0]&&e.target!==o.find("span.type")[0]&&a.action(e)},a.func=function(e){return e.aggregate||e.timeUnit||e.bin&&"bin"||e._aggr||e._timeUnit||e._bin&&"bin"||e._any&&"auto"},a.$watch("popupContent",function(e){e&&(r&&r.destroy(),r=new t({content:e,target:o.find(".type-caret")[0],position:"bottom left",openOn:"click"}))}),a.$on("$destroy",function(){r&&r.destroy()})}}})}(),function(){"use strict";function e(e){return e.reduce(function(e,t){return e[t.name]=t,e},{})}var t=[{name:"Barley",url:"data/barley.json",id:"barley",group:"sample"},{name:"Cars",url:"data/cars.json",id:"cars",group:"sample"},{name:"Crimea",url:"data/crimea.json",id:"crimea",group:"sample"},{name:"Driving",url:"data/driving.json",id:"driving",group:"sample"},{name:"Iris",url:"data/iris.json",id:"iris",group:"sample"},{name:"Jobs",url:"data/jobs.json",id:"jobs",group:"sample"},{name:"Population",url:"data/population.json",id:"population",group:"sample"},{name:"Movies",url:"data/movies.json",id:"movies",group:"sample"},{name:"Birdstrikes",url:"data/birdstrikes.json",id:"birdstrikes",group:"sample"},{name:"Burtin",url:"data/burtin.json",id:"burtin",group:"sample"},{name:"Budget 2016",url:"data/budget.json",id:"budget",group:"sample"},{name:"Climate Normals",url:"data/climate.json",id:"climate",group:"sample"},{name:"Campaigns",url:"data/weball26.json",id:"weball26",group:"sample"}];angular.module("vlui").factory("Dataset",function(n,a,o,r,i,l){var s={};s.datasets=t,s.dataset=t[1],s.currentDataset=void 0,s.dataschema=[],s.dataschema.byName={},s.stats={},s.type=void 0,s.typeNames={N:"text",O:"text-ordinal",Q:"number",T:"time",G:"geo"};var c={N:0,O:0,G:2,T:3,Q:4};return s.fieldOrderBy={},s.fieldOrderBy.type=function(e){return"count"===e.aggregate?4:c[e.type]},s.fieldOrderBy.typeThenName=function(e){return s.fieldOrderBy.type(e)+"_"+("count"===e.aggregate?"~":e.name.toLowerCase())},s.fieldOrderBy.original=function(){return 0},s.fieldOrderBy.name=function(e){return e.name},s.fieldOrderBy.cardinality=function(e,t){return t[e.name].distinct},s.fieldOrder=s.fieldOrderBy.typeThenName,s.getSchema=function(e,t,n){var a=i.type.inferAll(e),o=r.reduce(a,function(e,n,a){var o={name:a,type:l.data.types[n],primitiveType:n};return"Q"===o.type&&t[o.name].distinct<=5&&(o.type="O"),e.push(o),e},[]);return o=i.stablesort(o,n||s.fieldOrderBy.typeThenName,s.fieldOrderBy.name),o.push(l.field.count()),o},s.onUpdate=[],s.update=function(e){var t;return t=e.values?a(function(t,n){s.type=void 0,s.updateFromData(e,e.values),t()}):n.get(e.url,{cache:!0}).then(function(t){var n;return r.isObject(t.data)?(n=t.data,s.type="json",void s.updateFromData(e,n)):void o.add("Invalid data.",2e3)}),s.onUpdate.forEach(function(e){t=t.then(e)}),t},s.updateFromData=function(t,n){s.data=n,s.currentDataset=t,s.stats=l.data.stats(s.data),s.dataschema=s.getSchema(s.data,s.stats),s.dataschema.byName=e(s.dataschema)},s.add=function(e){return e.id||(e.id=e.url),t.push(e),e},s})}(),function(){"use strict";angular.module("vlui").service("Logger",function(e,t,n,a,o){var r={};return r.actions={INITIALIZE:"INITIALIZE",UNDO:"UNDO",REDO:"REDO",DATASET_CHANGE:"DATASET_CHANGE",CHART_MOUSEOVER:"CHART_MOUSEOVER",CHART_MOUSEOUT:"CHART_MOUSEOUT",CHART_RENDER:"CHART_RENDER",CHART_EXPOSE:"CHART_EXPOSE",CHART_TOOLTIP:"CHART_TOOLTIP",CHART_TOOLTIP_END:"CHART_TOOLTIP_END",BOOKMARK_ADD:"BOOKMARK_ADD",BOOKMARK_REMOVE:"BOOKMARK_REMOVE",BOOKMARKS_CLEAR:"BOOKMARKS_CLEAR",NULL_FILTER_TOGGLE:"NULL_FILTER_TOGGLE",TRANSPOSE_TOGGLE:"TRANSPOSE_TOGGLE",SORT_TOGGLE:"SORT_TOGGLE",MARKTYPE_TOGGLE:"MARKTYPE_TOGGLE",LOG_TOGGLE:"LOG_TOGGLE",FUNC_CHANGE:"FUNC_CHANGE",SPEC_CHANGE:"SPEC_CHANGE",FIELD_DROP:"FIELD_DROP",MARK_CHANGE:"MARK_CHANGE",FIELDS_CHANGE:"FIELDS_CHANGE",FIELDS_RESET:"FIELDS_RESET",DRILL_DOWN_OPEN:"DRILL_DOWN_OPEN",DRILL_DOWN_CLOSE:"DRILL_DOWN_CLOSE",CLUSTER_SELECT:"CLUSTER_SELECT",LOAD_MORE:"LOAD_MORE"},r.logInteraction=function(e,t,a){!n.logging},r})}(),function(){(function(){function e(t,a){function r(e){if(r[e]!==m)return r[e];var t;if("bug-string-char-index"==e)t="a"!="a"[0];else if("json"==e)t=r("json-stringify")&&r("json-parse");else{var n,o='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var s=a.stringify,u="function"==typeof s&&b;if(u){(n=function(){return 1}).toJSON=n;try{u="0"===s(0)&&"0"===s(new i)&&'""'==s(new l)&&s(y)===m&&s(m)===m&&s()===m&&"1"===s(n)&&"[1]"==s([n])&&"[null]"==s([m])&&"null"==s(null)&&"[null,null,null]"==s([m,y,null])&&s({a:[n,!0,!1,null,"\x00\b\n\f\r	"]})==o&&"1"===s(null,n)&&"[\n 1,\n 2\n]"==s([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==s(new c(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==s(new c(864e13))&&'"-000001-01-01T00:00:00.000Z"'==s(new c(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==s(new c(-1))}catch(d){u=!1}}t=u}if("json-parse"==e){var f=a.parse;if("function"==typeof f)try{if(0===f("0")&&!f(!1)){n=f(o);var g=5==n.a.length&&1===n.a[0];if(g){try{g=!f('"	"')}catch(d){}if(g)try{g=1!==f("01")}catch(d){}if(g)try{g=1!==f("1.")}catch(d){}}}}catch(d){g=!1}t=g}}return r[e]=!!t}t||(t=o.Object()),a||(a=o.Object());var i=t.Number||o.Number,l=t.String||o.String,s=t.Object||o.Object,c=t.Date||o.Date,u=t.SyntaxError||o.SyntaxError,d=t.TypeError||o.TypeError,f=t.Math||o.Math,g=t.JSON||o.JSON;"object"==typeof g&&g&&(a.stringify=g.stringify,a.parse=g.parse);var p,h,m,v=s.prototype,y=v.toString,b=new c(-0xc782b5b800cec);try{b=-109252==b.getUTCFullYear()&&0===b.getUTCMonth()&&1===b.getUTCDate()&&10==b.getUTCHours()&&37==b.getUTCMinutes()&&6==b.getUTCSeconds()&&708==b.getUTCMilliseconds()}catch(S){}var w="[object Function]",O="[object Date]",T="[object Number]",C="[object String]",E="[object Array]",_="[object Boolean]",A=r("bug-string-char-index");if(!b)var L=f.floor,N=[0,31,59,90,120,151,181,212,243,273,304,334],R=function(e,t){return N[t]+365*(e-1970)+L((e-1969+(t=+(t>1)))/4)-L((e-1901+t)/100)+L((e-1601+t)/400)};(p=v.hasOwnProperty)||(p=function(e){var t,n={};return(n.__proto__=null,n.__proto__={toString:1},n).toString!=y?p=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(t=n.constructor,p=function(e){var n=(this.constructor||t).prototype;return e in this&&!(e in n&&this[e]===n[e])}),n=null,p.call(this,e)}),h=function(e,t){var a,o,r,i=0;(a=function(){this.valueOf=0}).prototype.valueOf=0,o=new a;for(r in o)p.call(o,r)&&i++;return a=o=null,i?h=2==i?function(e,t){var n,a={},o=y.call(e)==w;for(n in e)o&&"prototype"==n||p.call(a,n)||!(a[n]=1)||!p.call(e,n)||t(n)}:function(e,t){var n,a,o=y.call(e)==w;for(n in e)o&&"prototype"==n||!p.call(e,n)||(a="constructor"===n)||t(n);(a||p.call(e,n="constructor"))&&t(n)}:(o=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],h=function(e,t){var a,r,i=y.call(e)==w,l=!i&&"function"!=typeof e.constructor&&n[typeof e.hasOwnProperty]&&e.hasOwnProperty||p;for(a in e)i&&"prototype"==a||!l.call(e,a)||t(a);for(r=o.length;a=o[--r];l.call(e,a)&&t(a));}),h(e,t)};var x={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},k="000000",I=function(e,t){return(k+(t||0)).slice(-e)},D="\\u00",F=function(e){for(var t='"',n=0,a=e.length,o=!A||a>10,r=o&&(A?e.split(""):e);a>n;n++){var i=e.charCodeAt(n);switch(i){case 8:case 9:case 10:case 12:case 13:case 34:case 92:t+=x[i];break;default:if(32>i){t+=D+I(2,i.toString(16));break}t+=o?r[n]:e.charAt(n)}}return t+'"'},U=function(e,t,n,a,o,r,i,l){var s,c,u,f,g,v,b,S,w,A,N,x,k,D,j,M;l=l||0;try{s=t[e]}catch(G){}if("object"==typeof s&&s)if(c=y.call(s),c!=O||p.call(s,"toJSON"))"function"==typeof s.toJSON&&(c!=T&&c!=C&&c!=E||p.call(s,"toJSON"))&&(s=s.toJSON(e));else if(s>-1/0&&1/0>s){if(R){for(g=L(s/864e5),u=L(g/365.2425)+1970-1;R(u+1,0)<=g;u++);for(f=L((g-R(u,0))/30.42);R(u,f+1)<=g;f++);g=1+g-R(u,f),v=(s%864e5+864e5)%864e5,b=L(v/36e5)%24,S=L(v/6e4)%60,w=L(v/1e3)%60,A=v%1e3}else u=s.getUTCFullYear(),f=s.getUTCMonth(),g=s.getUTCDate(),b=s.getUTCHours(),S=s.getUTCMinutes(),w=s.getUTCSeconds(),A=s.getUTCMilliseconds();s=(0>=u||u>=1e4?(0>u?"-":"+")+I(6,0>u?-u:u):I(4,u))+"-"+I(2,f+1)+"-"+I(2,g)+"T"+I(2,b)+":"+I(2,S)+":"+I(2,w)+"."+I(3,A)+"Z"}else s=null;if(n&&(s=n.call(t,e,s)),null===s)return"null";if(c=y.call(s),c==_)return""+s;if(c==T)return s>-1/0&&1/0>s?""+s:"null";if(c==C)return F(""+s);if("object"==typeof s){for(D=i.length;D--;)if(i[D]===s)throw d();if(i.push(s),N=[],j=r,r+=o,c==E){var M,H=r.length;for(k=0,D=s.length;D>k;k++)x=U(k,s,n,a,o,r,i,l),M=x===m?"null":x,H+=M.length+(k>0?1:0),N.push(M);M=N.length?o&&H>l?"[\n"+r+N.join(",\n"+r)+"\n"+j+"]":"["+N.join(",")+"]":"[]"}else{var H=r.length,k=0;h(a||s,function(e){var t,c=U(e,s,n,a,o,r,i,l);c!==m&&(t=F(e)+":"+(o?" ":"")+c,H+=t.length+(k++>0?1:0),N.push(t))}),M=N.length?o&&H>l?"{\n"+r+N.join(",\n"+r)+"\n"+j+"}":"{"+N.join(",")+"}":"{}"}return i.pop(),M}};if(a.stringify=function(e,t,a,o){var r,i,l,s;if(n[typeof t]&&t)if((s=y.call(t))==w)i=t;else if(s==E){l={};for(var c,u=0,d=t.length;d>u;c=t[u++],s=y.call(c),(s==C||s==T)&&(l[c]=1));}if(a)if((s=y.call(a))==T){if((a-=a%1)>0)for(r="",a>10&&(a=10);r.length<a;r+=" ");}else s==C&&(r=a.length<=10?a:a.slice(0,10));return U("",(c={},c[""]=e,c),i,l,r,"",[],o)},a.compactStringify=function(e,t,n){return a.stringify(e,t,n,60)},!r("json-parse")){var j,M,G=l.fromCharCode,H={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},P=function(){throw j=M=null,u()},B=function(){for(var e,t,n,a,o,r=M,i=r.length;i>j;)switch(o=r.charCodeAt(j)){case 9:case 10:case 13:case 32:j++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=A?r.charAt(j):r[j],j++,e;case 34:for(e="@",j++;i>j;)if(o=r.charCodeAt(j),32>o)P();else if(92==o)switch(o=r.charCodeAt(++j)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=H[o],j++;break;case 117:for(t=++j,n=j+4;n>j;j++)o=r.charCodeAt(j),o>=48&&57>=o||o>=97&&102>=o||o>=65&&70>=o||P();e+=G("0x"+r.slice(t,j));break;default:P()}else{if(34==o)break;for(o=r.charCodeAt(j),t=j;o>=32&&92!=o&&34!=o;)o=r.charCodeAt(++j);e+=r.slice(t,j)}if(34==r.charCodeAt(j))return j++,e;P();default:if(t=j,45==o&&(a=!0,o=r.charCodeAt(++j)),o>=48&&57>=o){for(48==o&&(o=r.charCodeAt(j+1),o>=48&&57>=o)&&P(),a=!1;i>j&&(o=r.charCodeAt(j),o>=48&&57>=o);j++);if(46==r.charCodeAt(j)){for(n=++j;i>n&&(o=r.charCodeAt(n),o>=48&&57>=o);n++);n==j&&P(),j=n}if(o=r.charCodeAt(j),101==o||69==o){for(o=r.charCodeAt(++j),(43==o||45==o)&&j++,n=j;i>n&&(o=r.charCodeAt(n),o>=48&&57>=o);n++);n==j&&P(),j=n}return+r.slice(t,j)}if(a&&P(),"true"==r.slice(j,j+4))return j+=4,!0;if("false"==r.slice(j,j+5))return j+=5,!1;if("null"==r.slice(j,j+4))return j+=4,null;P()}return"$"},z=function(e){var t,n;if("$"==e&&P(),"string"==typeof e){if("@"==(A?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];e=B(),"]"!=e;n||(n=!0))n&&(","==e?(e=B(),"]"==e&&P()):P()),","==e&&P(),t.push(z(e));return t}if("{"==e){for(t={};e=B(),"}"!=e;n||(n=!0))n&&(","==e?(e=B(),"}"==e&&P()):P()),(","==e||"string"!=typeof e||"@"!=(A?e.charAt(0):e[0])||":"!=B())&&P(),t[e.slice(1)]=z(B());return t}P()}return e},K=function(e,t,n){var a=J(e,t,n);a===m?delete e[t]:e[t]=a},J=function(e,t,n){var a,o=e[t];if("object"==typeof o&&o)if(y.call(o)==E)for(a=o.length;a--;)K(o,a,n);else h(o,function(e){K(o,e,n)});return n.call(e,t,o)};a.parse=function(e,t){var n,a;return j=0,M=""+e,n=z(B()),"$"!=B()&&P(),j=M=null,t&&y.call(t)==w?J((a={},a[""]=n,a),"",t):n}}return a.runInContext=e,a}var t="function"==typeof define&&define.amd,n={"function":!0,object:!0},a=n[typeof exports]&&exports&&!exports.nodeType&&exports,o=n[typeof window]&&window||this,r=a&&n[typeof module]&&module&&!module.nodeType&&"object"==typeof global&&global;if(!r||r.global!==r&&r.window!==r&&r.self!==r||(o=r),a&&!t)e(o,a);else{var i=o.JSON,l=o.JSON3,s=!1,c=e(o,o.JSON3={noConflict:function(){return s||(s=!0,o.JSON=i,o.JSON3=l,i=l=null),c}});o.JSON={parse:c.parse,stringify:c.stringify}}t&&define(function(){return c})}).call(this)}(),function(){"use strict";angular.module("vlui").directive("vlPlot",function(e,t,n,a,o,r,i,l,s,c,u){function d(e,t){return e>g||t>g||e*t>p?"svg":"canvas"}var f=0,g=16383.5,p=67108864,h=new u(function(e,t){return t.priority-e.priority});return{templateUrl:"vlplot/vlplot.html",restrict:"E",scope:{chart:"=",disabled:"=",isInList:"=",alwaysScrollable:"=",configSet:"@",maxHeight:"=",maxWidth:"=",overflow:"=",priority:"=",rescale:"=",thumbnail:"=",tooltip:"=",rendering:"="},replace:!0,link:function(a,u){function g(e,o){o.datum.data&&(a.tooltipPromise=n(function(){a.tooltipActive=!0,c.logInteraction(c.actions.CHART_TOOLTIP,o.datum),a.data=l.pairs(o.datum.data).map(function(e){return e.isNumber=t.isNumber(e[1]),e}),a.$digest();var n=u.find(".vis-tooltip"),r=angular.element(s),i=n.width(),d=n.height();e.pageY+10+d<r.height()?n.css("top",e.pageY+10):n.css("top",e.pageY-10-d),e.pageX+10+i<r.width()?n.css("left",e.pageX+10):n.css("left",e.pageX-10-i)},w))}function p(e,t){var o=u.find(".vis-tooltip");o.css("top",null),o.css("left",null),n.cancel(a.tooltipPromise),a.tooltipActive&&c.logInteraction(c.actions.CHART_TOOLTIP_END,t.datum),a.tooltipActive=!1,a.data=[],a.$digest()}function m(){var t=a.configSet||i.defaultConfigSet||{};if(a.chart.vlSpec){var n=l.cloneDeep(a.chart.vlSpec);return e.extend(n.config,r[t]()),e.compile(n,o.stats)}}function v(){if(a.rescale){for(var e=a.maxWidth>0?a.maxWidth/a.width:1,t=a.maxHeight>0?a.maxHeight/a.height:1,n=Math.min(e,t),o=1;.75*o>n;)o/=2;var r=100*o/2&&0;u.find(".vega").css("transform","translate(-"+r+"%, -"+r+"%) scale("+o+")")}else u.find(".vega").css("transform",null)}function y(){if(h.size()>0){var e=h.pop();e.parse()}else a.rendering=!1;n(function(){a.$apply()})}function b(n){function r(){if(a.destroyed||a.disabled||a.isInList&&a.chart.fieldSetKey&&!a.isInList(a.chart.fieldSetKey))return console.log("cancel rendering",l),void y();var e=(new Date).getTime();t.parse.spec(n,function(t){try{var r=(new Date).getTime();O=null,O=t({el:u[0]}),i.useUrl||O.data({raw:o.data}),a.width=O.width(),a.height=O.height(),O.renderer(d(n.width,a.height)),O.update(),c.logInteraction(c.actions.CHART_RENDER,a.chart.vlSpec),v();var s=(new Date).getTime();console.log("parse spec",r-e,"charting",s-r,l),a.tooltip&&(O.on("mouseover",g),O.on("mouseout",p))}catch(f){console.error(f)}finally{y()}})}if(!n)return void(O&&(O.off("mouseover"),O.off("mouseout")));a.height=n.height,u||console.error("can not find vis element");var l=a.chart.shorthand||(a.chart.vlSpec?e.Encoding.shorthand(a.chart.vlSpec):"");a.renderer=d(n),a.rendering?h.push({priority:a.priority||0,parse:r}):(a.rendering=!0,r())}var S=500,w=250;a.visId=f++,a.hoverPromise=null,a.tooltipPromise=null,a.hoverFocus=!1,a.tooltipActive=!1,a.destroyed=!1,a.rendering=!1,a.mouseover=function(){a.hoverPromise=n(function(){c.logInteraction(c.actions.CHART_MOUSEOVER,a.chart.vlSpec),a.hoverFocus=!a.thumbnail},S)},a.mouseout=function(){a.hoverFocus&&c.logInteraction(c.actions.CHART_MOUSEOUT,a.chart.vlSpec),n.cancel(a.hoverPromise),a.hoverFocus=a.unlocked=!1};var O;a.$watch("chart.vlSpec",function(){var t=a.chart.vgSpec=m();a.chart.cleanSpec||(a.chart.cleanSpec=e.Encoding.fromSpec(a.chart.vlSpec).toSpec(!0)),b(t)},!0),a.$on("$destroy",function(){console.log("vlplot destroyed"),O&&(O.off("mouseover"),O.off("mouseout"),O=null),a.destroyed=!0})}}})}(),function(){"use strict";angular.module("vlui").directive("vlPlotGroup",function(e,t,n,a,o,r,i){return{templateUrl:"vlplotgroup/vlplotgroup.html",restrict:"E",replace:!0,scope:{chart:"=",disabled:"=",isInList:"=",alwaysScrollable:"=",configSet:"@",maxHeight:"=",maxWidth:"=",overflow:"=",priority:"=",rescale:"=",thumbnail:"=",tooltip:"=",fieldSet:"=",showBookmark:"@",showDebug:"=",showExpand:"=",showFilterNull:"@",showLabel:"@",showLog:"@",showMarkType:"@",showSort:"@",showTranspose:"@",alwaysSelected:"=",isSelected:"=",highlighted:"=",expandAction:"&",chartType:"=",rendering:"="},link:function(r,l){r.consts=n,r.Dataset=o,r.log={},r.log.support=function(e,t){if(!e)return!1;var n=e.encoding,a=n[t];return a&&"Q"===a.type&&!a.bin},r.log.toggle=function(e,t){if(r.log.support(e,t)){var n=e.encoding[t],a=n.scale=n.scale||{};a.type="log"===a.type?"linear":"log",i.logInteraction(i.actions.LOG_TOGGLE,r.chart.shorthand)}},r.log.active=function(e,t){if(r.log.support(e,t)){var n=e.encoding[t],a=n.scale=n.scale||{};return"log"===a.type}};var s=r.toggleSort=function(e){i.logInteraction(i.actions.SORT_TOGGLE,r.chart.shorthand),a.Encoding.toggleSort(e)};s.support=a.Encoding.toggleSort.support,r.toggleFilterNull=function(e,t){i.logInteraction(i.actions.NULL_FILTER_TOGGLE,r.chart.shorthand),a.Encoding.toggleFilterNullO(e,t)},r.toggleFilterNull.support=a.Encoding.toggleFilterNullO.support,r.toggleSortClass=function(e){var t=e&&a.Encoding.toggleSort.direction(e),n=e&&a.Encoding.toggleSort.mode(e);return"y"===t?"Q"===n?"fa-sort-amount-desc":"fa-sort-alpha-asc":"x"===t?"Q"===n?"fa-sort-amount-desc sort-x":"fa-sort-alpha-asc sort-x":"invisible"},r.transpose=function(){i.logInteraction(i.actions.TRANSPOSE_TOGGLE,r.chart.shorthand),a.Encoding.transpose(r.chart.vlSpec)},r.chartChange=function(e){r.chartType=e},r.toggleFullscreen=function(){var e=l[0];document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?(t(e).removeClass("full-screen"),t(e).find(".vl-plot-wrapper").removeClass("full-screen"),document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()):(t(e).addClass("full-screen"),t(e).find(".vl-plot-wrapper").addClass("full-screen"),e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT))},e.bind("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(){var e=l[0];document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen||(t(e).removeClass("full-screen"),t(e).find(".vl-plot-wrapper").removeClass("full-screen"))}),r.$on("$destroy",function(){r.chart=null})}}})}(),function(){"use strict";angular.module("vlui").filter("compactJSON",function(){return function(e){return JSON.stringify(e,null,"  ",80)}})}(),function(){"use strict";angular.module("vlui").filter("encodeURI",function(){return function(e){return window.encodeURI(e)}})}(),function(){"use strict";angular.module("vlui").filter("scaleType",function(){return function(e){var t={Q:"Quantitative",N:"Nominal",O:"Ordinal",T:"Time"};return t[e]}})}(),function(){"use strict";angular.module("vlui").filter("underscore2space",function(){return function(e){return e?e.replace(/_+/g," "):""}})}(),function(){"use strict";angular.module("vlui").filter("reportUrl",function(e,t,n){function a(n){var a="https://docs.google.com/forms/d/1T9ZA14F3mmzrHR7JJVUKyPXzrMqF54CjLIOjv2E7ZEM/viewform?";if(n.fields){var o=encodeURI(e(t.values(n.fields)));a+="entry.1245199477="+o+"&"}if(n.encoding){var r=t.omit(n.encoding,"config");r=encodeURI(e(r)),a+="entry.1323680136="+r+"&"}if(n.encoding2){var i=t.omit(n.encoding2,"config");i=encodeURI(e(i)),a+="entry.853137786="+i+"&"}var l="entry.1940292677=";switch(n.type){case"vl":a+=l+"Visualization+Rendering+(Vegalite)&";break;case"vr":a+=l+"Recommender+Algorithm+(Visrec)&";break;case"fv":a+=l+"Recommender+UI+(FacetedViz)&"}return a}function o(n){var a="https://docs.google.com/forms/d/1xKs-qGaLZEUfbTmhdmSoS13OKOEpuu_NNWE5TAAml_Y/viewform?";if(n.encoding){var o=t.omit(n.encoding,"config");o=encodeURI(e(o)),a+="entry.1245199477="+o+"&"}return a}return"voyager"===n.appId?a:o})}();